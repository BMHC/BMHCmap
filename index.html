<!DOCTYPE html>
<html lang="en" dir="ltr">
    
<!--
index1.html
Copyright 2021 John R C Fairfield, see MIT license

https://stackoverflow.com/questions/4130237/displaying-crosshairs-in-the-center-of-a-javascript-google-map

<div><a href="url to google drive of help documentation" target="_blank" float="right">help manual</a></div>

-->

<head>
<meta charset="utf8">
    
<style>
  
    body {
        font-size:medium;
        font-family: 'Times New Roman', serif;
        background-color:#faf0e6; /*linen is #faf0e6. Or rgb(230,255, 220) is a light green;*/
    }

    input{
        font-family:'Times New Roman', serif;
    }
    
    
    .container {
        padding:0px 20px 0px 20px;
    }

    .textButton {
        padding: 0px 0px;
        border: none;
        font-family: 'Times New Roman', serif;
        background-color:#fffaf0;
    }

    
    .title {
        box-sizing: border-box;
        padding: 16px 0px;
    }
    
    #ss_elem_list, #inputAssemblyName {
        background-color:#d0efd0;
    }

  
</style>

<link rel="stylesheet" href="listbox/css/listbox.css"> 
<script src="listbox/js/listbox.js" type="text/javascript"></script>
<script src="listbox/js/listbox-scrollable.js" type="text/javascript"></script>   
<script src="listbox/js/utils.js" type="text/javascript"></script>
<script src="BMHC.js"></script>
    
</head>
    
<body>
   <div class="container">
        <div class="title">
            Brethren Mennonite Heritage Center
            <h1>Map data editor</h1>
        </div>
       
        <div id="midscreen">

            <div id="checkboxen">
               <b>Assembly Editor</b>
                &nbsp;&nbsp;
                <input type="checkbox" id="BrethrenCB" name="Brethren" onchange='changeBrethrenCB(this.checked);'>
                <label for="bro">Brethren</label>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <input type="checkbox" id="MennoniteCB" name="Mennonite" onchange='changeMennoniteCB(this.checked);'>
                <label for="menno">Mennonite</label>
                <br>
                <br>
            </div>

            <div id="scanAssemblies">
                <button id="newAssembly" class="textButton" onclick="initAssemblyEditing()">Click here to create a new assembly, </button>
                <br> or shift+click on a listed assembly to edit it,
                <br> or click on a listed assembly to go to the Event Editor.
                <br>
            </div> 

            <div id="editAssembly">
                A unique assembly name: 
                <br>
                <input type="text" id="inputAssemblyName" size=70>
                <br>
                <button type="button" onclick="initAssemblyViewer()">cancel</button> <button type="button" onclick="saveAssembly()">save</button> <button type="button" onclick="deleteAssembly()">delete</button> 
            </div>
            
            <div id="eventsConcerning">
               <b>Event Editor for:&nbsp;<span id="eventsAssemblyName"></span></b>
               <br>
            </div>
            
            <div id="scanEvents">
                <br>
                <button class="textButton" >Click here to create a new event, </button>
                <br> or shift+click on a listed event to edit its fields,
                <br> or click on a listed event to see the state of the assembly at that time.
                <br>
            </div> 
            
            <div class="editEvent">
                
                <form id="editEvent" onsubmit="unimplemented()">
                    <br>
                    <label for="eventDate">date (yyyy/mm/dd):</label>
                      <input type="text" id="eventDate" size=8 oninput="checkEventDate(this.value)">
                    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label for="eventVerb">verb:</label>
                    <select name="eventVerb" id="eventVerb"  required="true">
                      <option value="set-weight">set-weight</option>
                      <option value="set-locale">set-locale</option>
                      <option value="set-affiliation">set-affiliation</option>
                      <option value="image">image</option>
                      <option value="see-note">see-note</option>
                    </select>
                    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label>object:</label>
                    <input type="text" id="assemblyName" size=107 oninput="checkObjectAssembly(this.value)">
                    <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <label>note:</label>
                    <textarea type="text" id="eventNote" rows=3 cols=92 oninput="checkEventSubject(this.value)"> </textarea>
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="submit" value = "cancel"> <input type="submit" value="SAVE">
                </form>
            </div>
            
            <div id="assemblyState">
                <br>
                date: 1925
                <br>
                locale: 38.377180983452404, -79.03095281203223 1915 note: College Ave church
                <br>
                weight: 521 1925
                <br>
                affiliation: 2nd District of Virginia 1907 note: "Bridgewater" becomes independent from "Cooks Creek".
                labels: salaried pastor, sunday school
            </div>
             
            
        </div> <!-- end of div id=aboveList -->
            <!--<div class="listbox-area" > -->
       

            <div class="all-area">
                <ul id="ss_elem_list"
                    tabindex="0"
                    role="listbox"
                    aria-labelledby="ss_elem" >
            <!--    onclick ="whatever();"> <!--onselect, onchange don't work -->
                </ul>
            </div>  
    </div>
    
<script>

//globals
    
var divCaches = {
    checkboxen:"",
    scanAssemblies:"",
    editAssembly:"",
    eventsConcerning:"",
    scanEvents:"",
    editEvent:"",
    assemblyState:"",
}

var midscreenTypes =
    [["checkboxen","scanAssemblies"],         //0
     ["checkboxen","editAssembly"],           //1
     ["eventsConcerning","scanEvents"],       //2
     ["editEvent"],                           //3
     ["assemblyState"],                       //4
    ]

var checkboxState; // 0: assemblies that are neither B nor M, 1 B, 2 M, 3 all
var bmhc; //for BMHC.js object

// Of general utility:
    
function formatMidscreen(screenType){ //see midScreenTypes

    function setCheckboxen() { //0: neither checked, 1 Brethren, 2 Mennonite, 3 both
        document.getElementById("BrethrenCB").checked  = (checkboxState == 1 || checkboxState == 3);
        document.getElementById("MennoniteCB").checked = (checkboxState == 2 || checkboxState == 3);
    }

    var htmlStr = "";
    midscreenTypes[screenType].forEach(item => htmlStr+=divCaches[item]);
    document.getElementById("midscreen").innerHTML = htmlStr;
    if (screenType == 0 || screenType==1) setCheckboxen(); //checkboxen only exist in those types
}


function cacheDivs(){
    Object.keys(divCaches).forEach(key => {
        divCaches[key] = document.getElementById(key).innerHTML.slice();
    });
}
    
function makeLIsOfArray(arr){
    var result = "";
    
    function makeli(val) {
      result+= "<li id=\""+val+"\" role=\"option\" onclick='goToEventsEditor(\""+val+"\")'>"+val+"</li>";
    }
    
    arr.forEach(elem => makeli(elem));
    return result;
}
    
//Assembly viewer, screenType 0:
    
function initAssemblyViewer(){ 
    formatMidscreen(0);
    setAssemblyListboxInnerHTML();
}
    
function setAssemblyListboxInnerHTML(){
    var items = [];
    
    if (checkboxState == 0) items = bmhc.getNeitherAssemblies();
    else if (checkboxState == 1) items = bmhc.getBrethrenAssemblies();
    else if (checkboxState == 2) items = bmhc.getMennoniteAssemblies();
    else items = bmhc.getAllAssemblies();
    
    document.getElementById("ss_elem_list").innerHTML = makeLIsOfArray(items);
}

function changeBrethrenCB(checked){
    if (checked) checkboxState = checkboxState | 1;
    else checkboxState = checkboxState & 0xfffffe;  //...11110
    setAssemblyListboxInnerHTML();
}
    
function changeMennoniteCB(checked){
    if (checked) checkboxState = checkboxState | 2;
    else checkboxState = checkboxState & 0xfffffd;  //...11101
    setAssemblyListboxInnerHTML();
}

//onclick only responds to mouse click, not to movement of selection through typing prefixen
//or arrowUp arrowDn. Perhaps can use "return" key event to drive selection after movement.
function goToEventsEditor(val){
    formatMidscreen(2);
    document.getElementById("eventsAssemblyName").innerHTML = val;
    document.getElementById("ss_elem_list").innerHTML = makeLIsOfArray(bmhc.getEventStrings(val));
    //console.log(ss_elem_list.getAttribute('aria-activedescendant')); //dom not updated yet, reflects previous value
}

// Assembly editing, screenType 1

function initAssemblyEditing(name){
    formatMidscreen(1);
    document.getElementById("inputAssemblyName").value = (name && name.length)?name:"";
}

function saveAssembly(){
    var name = document.getElementById("inputAssemblyName").value;
    if (bmhc.assemblyExists(name)) alert("This assembly already exists.")
    else {
        bmhc.addAssembly(name,checkboxState);
        setAssemblyListboxInnerHTML();
    }
}
    
function deleteAssembly(){
    var name = document.getElementById("inputAssemblyName").value;
    if (!bmhc.assemblyExists(name)) alert("This assembly doesn't exist.")
    else {
        bmhc.deleteAssembly(name,checkboxState);
        setAssemblyListboxInnerHTML();
    }
}
    
    
cacheDivs();
bmhc = BMHCobj();
checkboxState = 1;
initAssemblyViewer();
    
</script>

</body>